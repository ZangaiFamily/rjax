<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>进阶 | Rjax</title>
    <meta name="description" content="base on rxjs awesome ajax library">
    
    
    <link rel="preload" href="/rjax/dist/assets/css/0.styles.6467ecbe.css" as="style"><link rel="preload" href="/rjax/dist/assets/js/app.11798775.js" as="script"><link rel="preload" href="/rjax/dist/assets/js/5.923b9e8f.js" as="script"><link rel="prefetch" href="/rjax/dist/assets/js/2.3badc248.js"><link rel="prefetch" href="/rjax/dist/assets/js/3.039c8eb4.js"><link rel="prefetch" href="/rjax/dist/assets/js/4.d46c551b.js"><link rel="prefetch" href="/rjax/dist/assets/js/6.399ce124.js"><link rel="prefetch" href="/rjax/dist/assets/js/7.736b3428.js"><link rel="prefetch" href="/rjax/dist/assets/js/8.35838317.js">
    <link rel="stylesheet" href="/rjax/dist/assets/css/0.styles.6467ecbe.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/rjax/dist/" class="home-link router-link-active"><!----> <span class="site-name">Rjax</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/rjax/dist/guide/" class="nav-link router-link-active">指南</a></div> <a href="https://github.com/ppjjzz/rjax" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/rjax/dist/guide/" class="nav-link router-link-active">指南</a></div> <a href="https://github.com/ppjjzz/rjax" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>指南</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/rjax/dist/guide/" class="sidebar-link">介绍</a></li><li><a href="/rjax/dist/guide/getting-started.html" class="sidebar-link">快速上手</a></li><li><a href="/rjax/dist/guide/advanced.html" class="active sidebar-link">进阶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rjax/dist/guide/advanced.html#拦截请求和响应" class="sidebar-link">拦截请求和响应</a></li><li class="sidebar-sub-header"><a href="/rjax/dist/guide/advanced.html#请求的防抖（debounce）" class="sidebar-link">请求的防抖（debounce）</a></li><li class="sidebar-sub-header"><a href="/rjax/dist/guide/advanced.html#配置请求" class="sidebar-link">配置请求</a></li><li class="sidebar-sub-header"><a href="/rjax/dist/guide/advanced.html#错误处理" class="sidebar-link">错误处理</a></li><li class="sidebar-sub-header"><a href="/rjax/dist/guide/advanced.html#请求非-json-格式的数据" class="sidebar-link">请求非 JSON 格式的数据</a></li><li class="sidebar-sub-header"><a href="/rjax/dist/guide/advanced.html#读取完整的响应体" class="sidebar-link">读取完整的响应体</a></li><li class="sidebar-sub-header"><a href="/rjax/dist/guide/advanced.html#监听进度事件" class="sidebar-link">监听进度事件</a></li></ul></li><li><a href="/rjax/dist/guide/example.html" class="sidebar-link">使用示例</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="进阶"><a href="#进阶" aria-hidden="true" class="header-anchor">#</a> 进阶</h1> <h2 id="拦截请求和响应"><a href="#拦截请求和响应" aria-hidden="true" class="header-anchor">#</a> 拦截请求和响应</h2> <p>使用拦截机制，你可以声明一些拦截器，用它们监视和转换从应用发送到服务器的 HTTP 请求。 拦截器还可以用监视和转换从服务器返回到本应用的那些响应。 多个选择器会构成一个“请求/响应处理器”的双向链表。</p> <p>拦截器可以用一种常规的、标准的方式对每一次 HTTP 的请求/响应任务执行从认证到记日志等很多种隐式任务。</p> <p>如果没有拦截机制，那么开发人员将不得不对每次 HttpClient 调用显式实现这些任务。</p> <h3 id="编写拦截器"><a href="#编写拦截器" aria-hidden="true" class="header-anchor">#</a> 编写拦截器</h3> <p>要实现拦截器，就要实现一个实现了 HttpInterceptor 接口中的 intercept() 方法的类。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> HttpResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rjax'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Observable <span class="token punctuation">,</span>  throwError <span class="token keyword">as</span> _throw <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> tap<span class="token punctuation">,</span> mergeMap<span class="token punctuation">,</span> finalize<span class="token punctuation">,</span> catchError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Rjax <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rjax'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CustomInterceptor</span> <span class="token punctuation">{</span>
    <span class="token function">intercept</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'拦截请求'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 一定要用clone的方法进行拦截修改，为了保持请求的不可变性！！！！</span>
        <span class="token keyword">const</span> newReq <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            url<span class="token punctuation">:</span> req<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'http://'</span><span class="token punctuation">,</span> <span class="token string">'https://'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 修改请求的url</span>
            body<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token operator">...</span>req<span class="token punctuation">.</span>body<span class="token punctuation">,</span> name<span class="token punctuation">:</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token comment">// 修改请求体</span>
            headers<span class="token punctuation">:</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'Authorization'</span><span class="token punctuation">,</span> <span class="token string">'authToken'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 添加请求头</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> next<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>newReq<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
            <span class="token function">tap</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'拦截响应'</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">,</span> <span class="token function">mergeMap</span><span class="token punctuation">(</span>event <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// 这里可根据后台接口约定自行判断</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token keyword">instanceof</span> <span class="token class-name">HttpResponse</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>status <span class="token operator">!==</span> <span class="token number">200</span> <span class="token operator">||</span> <span class="token operator">!</span>event<span class="token punctuation">.</span>body<span class="token punctuation">.</span>success<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> Observable<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>observer <span class="token operator">=&gt;</span> observer<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> Observable<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>observer <span class="token operator">=&gt;</span> observer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">,</span> <span class="token function">catchError</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">switch</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token number">401</span><span class="token punctuation">:</span>
                    <span class="token comment">// 拦截到401错误</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token number">200</span><span class="token punctuation">:</span>
                    <span class="token comment">// 业务层级错误处理</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token number">404</span><span class="token punctuation">:</span>

                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token number">500</span><span class="token punctuation">:</span>

                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token punctuation">:</span>

                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> <span class="token function">_throw</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将错误信息抛给下个拦截器或者请求调用方</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// 无论成功或者失败都会执行</span>
                <span class="token comment">// 可以记录日志等等</span>
            <span class="token punctuation">}</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 创建实例</span>
<span class="token keyword">const</span> rjax <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Rjax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  interceptors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">CustomInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">// 设置请求响应拦截器，可设置多组</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="拦截器的顺序"><a href="#拦截器的顺序" aria-hidden="true" class="header-anchor">#</a> 拦截器的顺序</h3> <p>Rjax 会按照你提供它们的顺序应用这些拦截器。 如果你提供拦截器的顺序是先 A，再 B，再 C，那么请求阶段的执行顺序就是 A-&gt;B-&gt;C，而响应阶段的执行顺序则是 C-&gt;B-&gt;A。</p> <p>以后你就再也不能修改这些顺序或移除某些拦截器了。 如果你需要动态启用或禁用某个拦截器，那就要在那个拦截器中自行实现这个功能。</p> <h2 id="请求的防抖（debounce）"><a href="#请求的防抖（debounce）" aria-hidden="true" class="header-anchor">#</a> 请求的防抖（debounce）</h2> <p>当用户在搜索框中输入名字时进行远程检索</p> <p>如果每次击键都发送一次请求就太昂贵了。 最好能等到用户停止输入时才发送请求。 使用 RxJS 的操作符就能轻易实现它，参见下面的代码片段：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Subject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> debounceTime<span class="token punctuation">,</span> distinctUntilChanged<span class="token punctuation">,</span> switchMap <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Rjax <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rjax'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">InputSearch</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
    subject$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    state <span class="token operator">=</span> <span class="token punctuation">{</span>
        data<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    rjax <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Rjax</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>subjectRef <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subject<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
            <span class="token function">debounceTime</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">distinctUntilChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">switchMap</span><span class="token punctuation">(</span>name <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rjax<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`/user`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>params<span class="token punctuation">:</span> name<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    data<span class="token punctuation">:</span> res
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> err <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求出错'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 组件卸载时取消订阅</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>subjectRef<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function-variable function">search</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>target<span class="token punctuation">:</span> value<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>subject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span> value<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span>data<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>search<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                    </span><span class="token punctuation">{</span>data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>除了把每个 input 的值都直接转发给 <code>/user</code> 请求 componentDidMount() 中的代码还通过下列三个操作符对这些搜索值进行管道处理：</p> <ol><li>debounceTime(500) - 等待，直到用户停止输入（这个例子中是停止 1/2 秒）。</li> <li>distinctUntilChanged() - 等待，直到搜索内容发生了变化。</li> <li>switchMap() - 把搜索请求发送给rjax。</li></ol> <p>这样，只有当用户停止了输入且搜索值和以前不一样的时候，搜索值才会传给rjax发起请求。</p> <h3 id="switchmap"><a href="#switchmap" aria-hidden="true" class="header-anchor">#</a> switchMap()</h3> <p>这个 switchMap() 操作符有三个重要的特征：</p> <ol><li>它的参数是一个返回 Observable 的函数。rjax.get() 会返回 Observable，其它请求方法也一样。</li> <li>如果以前的搜索结果仍然是在途状态（这会出现在慢速网络中），它会取消那个请求，并发起这个新的搜索。</li> <li>它会按照原始的请求顺序返回这些服务的响应，而不用关心服务器实际上是以乱序返回的它们。</li></ol> <h2 id="配置请求"><a href="#配置请求" aria-hidden="true" class="header-anchor">#</a> 配置请求</h2> <p>待发送请求的option可以通过传给 Rjax 方法最后一个参数中的配置对象进行配置。</p> <h3 id="添加请求头"><a href="#添加请求头" aria-hidden="true" class="header-anchor">#</a> 添加请求头</h3> <p>很多服务器在进行保存型操作时需要额外的请求头。 比如，它们可能需要一个 Content-Type 头来显式定义请求体的 MIME 类型。 也可能服务器会需要一个认证用的令牌（token）。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> HttpHeaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rjax'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> httpOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  headers<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">HttpHeaders</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'Content-Type'</span><span class="token punctuation">:</span>  <span class="token string">'application/json'</span><span class="token punctuation">,</span>
    <span class="token string">'Authorization'</span><span class="token punctuation">:</span> <span class="token string">'my-auth-token'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

rjax<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`/user`</span></span><span class="token punctuation">,</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'xxxx'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> httpOptions<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> err <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求出错'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="修改请求头"><a href="#修改请求头" aria-hidden="true" class="header-anchor">#</a> 修改请求头</h3> <p>你没法直接修改前述配置对象中的现有头，因为这个 HttpHeaders 类的实例是不可变的。</p> <p>改用 set() 方法代替。 它会返回当前实例的一份克隆，其中应用了这些新修改。</p> <p>比如在发起下一个请求之前，如果旧的令牌已经过期了，你可能还要修改认证头。</p> <div class="language-js extra-class"><pre class="language-js"><code>httpOptions<span class="token punctuation">.</span>headers <span class="token operator">=</span>
  httpOptions<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'Authorization'</span><span class="token punctuation">,</span> <span class="token string">'my-new-auth-token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="url参数"><a href="#url参数" aria-hidden="true" class="header-anchor">#</a> URL参数</h3> <p>添加 URL 搜索参数也与此类似。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> HttpParams <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rjax'</span><span class="token punctuation">;</span>

<span class="token function">searchUsers</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  name <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> options <span class="token operator">=</span> term <span class="token operator">?</span>
   <span class="token punctuation">{</span> params<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">HttpParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rjax<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`/user`</span></span><span class="token punctuation">,</span> options<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">catchError</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleError</span><span class="token punctuation">(</span><span class="token string">'searchUsers'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>HttpParams 是不可变的，所以你也要使用 set() 方法来修改这些选项。</p> <h2 id="错误处理"><a href="#错误处理" aria-hidden="true" class="header-anchor">#</a> 错误处理</h2> <p>如果这个请求导致了服务器错误怎么办？甚至，在烂网络下请求都没到服务器该怎么办？Rjax 就会返回一个错误（error）而不再是成功的响应。</p> <p>通过在 .subscribe() 中添加第二个回调函数，你可以在组件中处理它：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">showConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>configService<span class="token punctuation">.</span><span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span>data<span class="token punctuation">:</span> Config<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>config <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>data <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// success path</span>
      error <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>error <span class="token operator">=</span> error <span class="token comment">// error path</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在数据访问失败时给用户一些反馈，确实是个好主意。 不过，直接显示由 Rjax 返回的原始错误数据还远远不够。</p> <h3 id="获取错误详情"><a href="#获取错误详情" aria-hidden="true" class="header-anchor">#</a> 获取错误详情</h3> <p>检测错误的发生是第一步，不过如果知道具体发生了什么错误才会更有用。上面例子中传给回调函数的 err 参数的类型是 HttpErrorResponse，它包含了这个错误中一些很有用的信息。</p> <p>可能发生的错误分为两种。如果后端返回了一个失败的返回码（如 404、500 等），它会返回一个错误响应体。</p> <p>或者，如果在客户端这边出了错误（比如在 RxJS 操作符 (operator) 中抛出的异常或某些阻碍完成这个请求的网络错误），就会抛出一个 Error 类型的异常。</p> <p>Rjax 会在 HttpErrorResponse 中捕获所有类型的错误信息，你可以查看这个响应体以了解到底发生了什么。</p> <p>你可能首先要设计一个错误处理器，就像这样：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">handleError</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>error <span class="token keyword">instanceof</span> <span class="token class-name">ErrorEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// A client-side or network error occurred. Handle it accordingly.</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'An error occurred:'</span><span class="token punctuation">,</span> error<span class="token punctuation">.</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// The backend returned an unsuccessful response code.</span>
    <span class="token comment">// The response body may contain clues as to what went wrong,</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token string">`Backend returned code </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, `</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token string">`body was: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// return an observable with a user-facing error message</span>
  <span class="token keyword">return</span> <span class="token function">throwError</span><span class="token punctuation">(</span>
    <span class="token string">'Something bad happened; please try again later.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>注意，该处理器返回一个带有用户友好的错误信息的 RxJS ErrorObservable 对象。 该服务的消费者期望服务的方法返回某种形式的 Observable，就算是“错误的”也可以。</p> <p>现在，你获取了由 Rjax 方法返回的 Observable，并把它们通过管道传给错误处理器。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> catchError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>

<span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rjax<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>configUrl<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">catchError</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleError<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="retry"><a href="#retry" aria-hidden="true" class="header-anchor">#</a> retry()</h3> <p>有时候，错误只是临时性的，只要重试就可能会自动消失。 比如，在移动端场景中可能会遇到网络中断的情况，只要重试一下就能拿到正确的结果。</p> <p>RxJS 库提供了几个 retry 操作符，它们值得仔细看看。 其中最简单的是 retry()，它可以对失败的 Observable 自动重新订阅几次。对 HttpClient 方法调用的结果进行重新订阅会导致重新发起 HTTP 请求。</p> <p>把它插入到 Rjax 方法结果的管道中，就放在错误处理器的紧前面。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> retry<span class="token punctuation">,</span> catchError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>

<span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rjax<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>configUrl<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">retry</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// retry a failed request up to 3 times</span>
      <span class="token function">catchError</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleError<span class="token punctuation">)</span> <span class="token comment">// then handle the error</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="请求非-json-格式的数据"><a href="#请求非-json-格式的数据" aria-hidden="true" class="header-anchor">#</a> 请求非 JSON 格式的数据</h2> <p>不是所有的 API 都会返回 JSON 数据。在下面这个例子中的方法会从服务器读取文本文件， 并把文件的内容记录下来，然后把这些内容使用 Observable 的形式返回给调用者。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">getTextFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// The Observable returned by get() is of type Observable&lt;string&gt;</span>
  <span class="token comment">// because a text response was specified.</span>
  <span class="token comment">// There's no need to pass a &lt;string&gt; type parameter to get().</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rjax<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token punctuation">{</span>responseType<span class="token punctuation">:</span> <span class="token string">'text'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">tap</span><span class="token punctuation">(</span> <span class="token comment">// Log the result or error</span>
        data <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">,</span>
        error <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">logError</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> error<span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里的 rjax.get() 返回字符串而不是默认的 JSON 对象，因为它的 responseType 选项是 'text'。</p> <p>这里的 rjax.get() 返回字符串而不是默认的 JSON 对象，因为它的 responseType 选项是 'text'。</p> <p>responseType的可选值有 &quot;arraybuffer&quot; | &quot;blob&quot; | &quot;text&quot; | &quot;json&quot;</p> <h2 id="读取完整的响应体"><a href="#读取完整的响应体" aria-hidden="true" class="header-anchor">#</a> 读取完整的响应体</h2> <p>响应体可能并不包含你需要的全部信息。有时候服务器会返回一个特殊的响应头或状态码，以标记出特定的条件，因此读取它们可能是必要的。</p> <p>要这样做，你就要通过 observe 选项来告诉 Rjax，你想要完整的响应信息，而不是只有响应体：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">getConfigResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rjax<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>configUrl<span class="token punctuation">,</span> <span class="token punctuation">{</span> observe<span class="token punctuation">:</span> <span class="token string">'response'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>现在 rjax.get() 会返回一个 <a href="https://www.angular.cn/api/common/http/HttpResponse" target="_blank" rel="noopener noreferrer">HttpResponse<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 类型的 Observable，而不只是 JSON 数据。</p> <h2 id="监听进度事件"><a href="#监听进度事件" aria-hidden="true" class="header-anchor">#</a> 监听进度事件</h2> <p>有时，应用会传输大量数据，并且这些传输可能会花费很长时间。 典型的例子是文件上传。 可以通过在传输过程中提供进度反馈，来提升用户体验。</p> <p>要想开启进度事件的响应，你可以创建一个把 reportProgress 选项设置为 true 的 HttpRequest 实例，以开启进度跟踪事件。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> HttpRequest <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rjax'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpRequest</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'/upload/file'</span><span class="token punctuation">,</span> file<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  reportProgress<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>每个进度事件都会触发变更检测，所以，你应该只有当确实希望在 UI 中报告进度时才打开这个选项。</p></div> <p>接下来，把这个请求对象传给 rjax.request() 方法，它返回一个 HttpEvents 的 Observable，同样也可以在拦截器中处理这些事件。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rjax<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
  <span class="token function">map</span><span class="token punctuation">(</span>event <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getEventMessage</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">tap</span><span class="token punctuation">(</span>message <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">showProgress</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// return last (completed) message to caller</span>
  <span class="token function">catchError</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleError</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>getEventMessage 方法会解释事件流中的每一个 HttpEvent 类型。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> HttpEventType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rjax'</span><span class="token punctuation">;</span>

<span class="token comment">/** Return distinct message for sent, upload progress, &amp; response events */</span>
<span class="token keyword">private</span> <span class="token function">getEventMessage</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> HttpEventType<span class="token punctuation">.</span>Sent<span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`Uploading file &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; of size </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token punctuation">.</span>size<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.`</span></span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> HttpEventType<span class="token punctuation">.</span>UploadProgress<span class="token punctuation">:</span>
      <span class="token comment">// Compute and show the % done:</span>
      <span class="token keyword">const</span> percentDone <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">*</span> event<span class="token punctuation">.</span>loaded <span class="token operator">/</span> event<span class="token punctuation">.</span>total<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`File &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>percentDone<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">% uploaded.`</span></span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> HttpEventType<span class="token punctuation">.</span>Response<span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`File &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; was completely uploaded!`</span></span><span class="token punctuation">;</span>

    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`File &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; surprising upload event: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/rjax/dist/guide/getting-started.html" class="prev">
          快速上手
        </a></span> <span class="next"><a href="/rjax/dist/guide/example.html">
          使用示例
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/rjax/dist/assets/js/app.11798775.js" defer></script><script src="/rjax/dist/assets/js/5.923b9e8f.js" defer></script>
  </body>
</html>
